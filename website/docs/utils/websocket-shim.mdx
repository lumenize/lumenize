---
title: WebSocket Shim
description: Browser-compatible WebSocket API for cloudflare:test environment
---

# WebSocket Shim

The `getWebSocketShim` function provides a browser-compatible WebSocket API for testing Durable Objects in the `cloudflare:test` environment. This enables you to test WebSocket functionality using the familiar WebSocket API.

## Installation

```bash npm2yarn
npm install @lumenize/utils
```

## Basic Usage

```typescript
import { getWebSocketShim } from '@lumenize/utils';
// @ts-expect-error - cloudflare:test module types are not consistently exported
import { SELF } from 'cloudflare:test';

// Create a WebSocket class that works in cloudflare:test
const WebSocketClass = getWebSocketShim(SELF.fetch.bind(SELF));

// Use it like a browser WebSocket
const ws = new WebSocketClass('wss://my-do/instance-name/websocket');

ws.onopen = () => {
  console.log('Connected!');
  ws.send('Hello');
};

ws.onmessage = (event) => {
  console.log('Received:', event.data);
};
```

## Cookie-Aware WebSockets

You can pass a cookie-aware fetch function to enable WebSocket connections with cookies:

```typescript
import { CookieJar, getWebSocketShim } from '@lumenize/utils';
// @ts-expect-error - cloudflare:test module types are not consistently exported
import { SELF } from 'cloudflare:test';

const cookieJar = new CookieJar();
const cookieAwareFetch = cookieJar.getFetch(SELF.fetch.bind(SELF));

// WebSocket connections will now include cookies
const WebSocketClass = getWebSocketShim(cookieAwareFetch);
const ws = new WebSocketClass('wss://my-do/instance-name/websocket');
```

## Usage Examples

The WebSocket shim is used extensively throughout the RPC documentation for testing WebSocket functionality:

- **[RPC Quick Start](/docs/rpc/quick-start)** - Basic WebSocket RPC usage
- **[WebSocket Testing](/docs/rpc/websocket-testing)** - Comprehensive WebSocket testing patterns
- **[Manual Instrumentation](/docs/rpc/manual-instrumentation)** - Custom WebSocket message handling
- **[Cookie Jar](/docs/utils/cookie-jar)** - Cookie-aware WebSocket connections

## API Reference

For detailed API documentation, see the [getWebSocketShim API reference](/docs/utils/api/functions/getWebSocketShim).

## Key Features

- **Browser-compatible API**: Uses the standard WebSocket interface
- **Cookie support**: Works with CookieJar for authenticated connections
- **Test-friendly**: Designed specifically for the cloudflare:test environment
- **Type-safe**: Full TypeScript support
