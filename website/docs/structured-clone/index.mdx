---
title: "@lumenize/structured-clone"
description: "Zero-dependency serialization with full-fidelity type support for JavaScript"
---

# @lumenize/structured-clone

A zero-dependency fork of `@ungap/structured-clone` with enhanced serialization for complex JavaScript types including Errors, Web API objects, and special numbers.

## Why This Package?

When building RPC systems, storing data, or passing objects between contexts, you need to serialize complex JavaScript objects. JSON alone isn't enough:

- **Lost Types**: JSON loses `Date`, `Map`, `Set`, `Error` objects
- **No Circulars**: JSON can't handle circular references
- **No Special Numbers**: JSON converts `NaN` and `Infinity` to `null`
- **No Web API Objects**: JSON can't serialize `Request`, `Response`, `Headers`, `URL`

This package solves all of these problems while maintaining a single, efficient object traversal.

## Installation

```bash @skip-check
npm install @lumenize/structured-clone
```

## Supported Types

While this package was originally optimized for the Cloudflare edge compute platform, **nothing in it is Cloudflare-specific**. All tests run in both Node.js and simulated Cloudflare environments, with plans to add headless browser testing. Our primary use case includes browser clients, and it runs perfectly in browser environments today.

**Not a Cloudflare user?** Feel free to ignore the first three columns in the comparison table below. This package is simply an enhanced fork of the excellent `@ungap/structured-clone` with better Error handling, special number support, and Web API object serialization—useful in any JavaScript environment.

import TypeSupportTable from '@site/docs/_partials/_type-support-table.mdx';

<TypeSupportTable />

### Key Highlights

- **Platform Independent**: Works in Node.js, browsers, Deno, Bun, and Cloudflare Workers
- **Full Type Support**: All primitives, special numbers (`NaN`, `Infinity`, `-Infinity`), built-in types (`Date`, `RegExp`, `Map`, `Set`), typed arrays, and Web API objects
- **Error Fidelity**: Preserves stack traces, `cause` chains, custom properties, and subclass types
- **Circular References**: Automatically handled without errors
- **Zero Dependencies**: No external packages required

### Why Fork @ungap/structured-clone?

We needed several enhancements that go beyond the original:
- **Full Error fidelity**: Stack traces, `cause` chains, custom properties, and subclass types
- **Special numbers**: `NaN`, `Infinity`, `-Infinity` preserved (JSON converts these to `null`)
- **Web API objects**: Native `Request`, `Response`, `Headers`, `URL` serialization
- **Strict symbol handling**: Always throws on symbols (consistent behavior)
- **Async API**: All methods async for Request/Response body reading
- **Single object walk**: All enhancements integrated into one traversal for efficiency

## Basic Usage

The core API is simple: `stringify()` to serialize, `parse()` to deserialize.

```typescript @check-example packages/structured-clone/test/for-docs/basic-usage.test.ts
import { stringify, parse } from '@lumenize/structured-clone';

const user = {
  name: 'Alice',
  age: 30,
  active: true
};

const serialized = await stringify(user);
const restored = await parse(serialized);

expect(restored.name).toBe('Alice');
// ...
```

This works with complex nested structures, arrays, and all types shown in the table above.

## Key Features with Examples

### Error Chains with `cause`

Error chaining is fully preserved, including nested causes:

```typescript @check-example packages/structured-clone/test/for-docs/errors.test.ts
const networkError = new Error('Connection timeout');
const appError = new Error('Failed to fetch user data', { 
  cause: networkError 
});

const restored = await parse(await stringify(appError));

expect(restored.message).toBe('Failed to fetch user data');
expect(restored.cause).toBeInstanceOf(Error);
expect(restored.cause.message).toBe('Connection timeout');
```

### Custom Error Properties

Add arbitrary properties to Errors—they're all preserved:

```typescript @check-example packages/structured-clone/test/for-docs/errors.test.ts
const apiError: any = new Error('API request failed');
apiError.statusCode = 500;
apiError.endpoint = '/api/users';

const restored: any = await parse(await stringify(apiError));

expect(restored.message).toBe('API request failed');
expect(restored.statusCode).toBe(500);
// ...
```

### Web API Objects Example

Serialize Request/Response objects for storage, queues, or RPC:

```typescript @check-example packages/structured-clone/test/for-docs/web-api.test.ts
const apiData = {
  incomingRequest: new Request('https://api.example.com/endpoint', {
    method: 'POST',
    body: 'request data'
  }),
  outgoingResponse: new Response('response data', {
    status: 200
  }),
  timestamp: Date.now()
};

const restored = await parse(await stringify(apiData));

expect(restored.incomingRequest).toBeInstanceOf(Request);
// ...
```

**Note:** Request/Response bodies are consumed during serialization (streams become strings).

## Limitations

- **Symbols**: Cannot be serialized (throws `TypeError`)
- **Functions**: Converted to internal markers (preserved structure, not executable)
- **Signed Zero**: `-0` becomes `+0` (JSON limitation)
- **Streams**: `ReadableStream`/`WritableStream` not supported

## License

ISC License (from @ungap/structured-clone)

Lumenize extensions © 2025

## Attribution

Forked from [`@ungap/structured-clone`](https://github.com/ungap/structured-clone) by Andrea Giammarchi.

See [ATTRIBUTIONS.md](https://github.com/lumenize/lumenize/blob/main/ATTRIBUTIONS.md) for full attribution details.

